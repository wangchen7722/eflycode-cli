{% if tools is defined %}
<tool_call_guidelines>
1. ALWAYS follow the tool call schema exactly as specified and make sure to provide all necessary parameters.
2. NEVER call tools that are not explicitly provided, even if the USER requests. You have access to the following tools [{% for tool_name in tools.keys() %}{{ tool_name }}{% if not loop.last %}, {% endif %}{% endfor %}].
3. You ONLY can use ONE tool call per message, and will receive the tool call result in the following user message.
4. You MUST explain clearly in first-person what action you am taking and why, without mentioning the tool itself. For example: "I need to check the content of xxx file" or "I want to look up the latest updates on yyy". 
5. If USER refuse to execute the tool call, you MUST politely ask for the reason and explain why you need the tool call.
</tool_call_guidelines>

<tool_call_formatting>
If you need to use a tool, you must format your message in the following way:
{{ stream_parser.tool_call_start }}
{{ stream_parser.tool_name_start }}tool_name{{ stream_parser.tool_name_end }}
{{ stream_parser.tool_params_start }}
{
  "parameter name": "parameter value"
}
{{ stream_parser.tool_params_end }}
{{ stream_parser.tool_call_end }}
</tool_call_formatting>

<tool_namespace>
{% for tool_name, tool in tools.items() %}
## {{ loop.index }}. {{ tool_name }}
def {{ tool_name }}(
    {% for param_name, param_schema in tool.parameters.items() %}
    {{ param_name }}: {{ param_schema.type }}{{ "," if not loop.last else "" }}
    {% endfor %}
) -> str:
    """{{ tool.description }}

    Parameters:
    {% for param_name, param_schema in tool.parameters.items() %}
    - {{ param_name }}: {{ "(required)" if param_schema.required else "(optional)" }} {{ param_schema.description }}{{ " default is " ~ param_schema.default if param_schema.default is defined else "" }}
    {% endfor %}
    """
    ...

{% endfor %}
</tool_namespace>
{% endif %}